name: Deploy to GitHub Pages

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Create index.html
        run: |
          cat > index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="zh-CN">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
              <title>满屏爱心与飘字特效</title>
              <style>
                  * {
                      margin: 0;
                      padding: 0;
                      box-sizing: border-box;
                      touch-action: manipulation;
                  }
                  
                  body {
                      font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
                      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
                      color: white;
                      overflow: hidden;
                      height: 100vh;
                      width: 100vw;
                      display: flex;
                      flex-direction: column;
                      align-items: center;
                      justify-content: center;
                      -webkit-tap-highlight-color: transparent;
                  }
                  
                  .container {
                      text-align: center;
                      z-index: 10;
                      padding: 15px;
                      background: rgba(0, 0, 0, 0.5);
                      border-radius: 15px;
                      backdrop-filter: blur(5px);
                      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                      max-width: 95%;
                      margin: 10px;
                  }
                  
                  h1 {
                      margin-bottom: 15px;
                      font-size: 1.8rem;
                      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
                  }
                  
                  .controls {
                      display: flex;
                      flex-wrap: wrap;
                      gap: 8px;
                      justify-content: center;
                      margin: 15px 0;
                  }
                  
                  input, button {
                      padding: 12px 15px;
                      border: none;
                      border-radius: 8px;
                      font-size: 1rem;
                      min-height: 44px;
                  }
                  
                  input {
                      width: 100%;
                      background: rgba(255, 255, 255, 0.9);
                      margin-bottom: 5px;
                  }
                  
                  button {
                      background: #ff4081;
                      color: white;
                      cursor: pointer;
                      transition: all 0.3s;
                      flex: 1;
                      min-width: 120px;
                  }
                  
                  button:hover, button:active {
                      background: #e91e63;
                      transform: scale(1.05);
                  }
                  
                  canvas {
                      position: fixed;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      z-index: 1;
                      touch-action: none;
                  }
                  
                  .instructions {
                      margin-top: 15px;
                      font-size: 0.85rem;
                      opacity: 0.8;
                      line-height: 1.4;
                  }
                  
                  @media (max-width: 480px) {
                      .container {
                          padding: 12px;
                      }
                      
                      h1 {
                          font-size: 1.5rem;
                      }
                      
                      button {
                          min-width: 100px;
                          padding: 10px 12px;
                      }
                      
                      .instructions {
                          font-size: 0.8rem;
                      }
                  }
                  
                  /* 加载动画 */
                  .loader {
                      position: fixed;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      z-index: 100;
                      transition: opacity 0.5s;
                  }
                  
                  .loader-content {
                      text-align: center;
                  }
                  
                  .loader-heart {
                      font-size: 3rem;
                      animation: pulse 1.5s infinite;
                      margin-bottom: 20px;
                  }
                  
                  @keyframes pulse {
                      0% { transform: scale(1); }
                      50% { transform: scale(1.2); }
                      100% { transform: scale(1); }
                  }
              </style>
          </head>
          <body>
              <!-- 加载动画 -->
              <div class="loader" id="loader">
                  <div class="loader-content">
                      <div class="loader-heart">❤️</div>
                      <h2>满屏爱心与飘字特效</h2>
                      <p>加载中...</p>
                  </div>
              </div>
              
              <div class="container">
                  <h1>❤️ 满屏爱心与飘字特效 ❤️</h1>
                  <div class="controls">
                      <input type="text" id="textInput" placeholder="输入想要飘动的文字...">
                      <button id="addText">添加文字</button>
                      <button id="addHearts">添加爱心</button>
                      <button id="clearAll">清空屏幕</button>
                  </div>
                  <p class="instructions">点击屏幕任意位置生成爱心 | 输入文字并点击添加文字按钮</p>
              </div>
              
              <canvas id="canvas"></canvas>

              <script>
                  // 等待页面加载
                  window.addEventListener('load', function() {
                      // 隐藏加载动画
                      setTimeout(function() {
                          document.getElementById('loader').style.opacity = '0';
                          setTimeout(function() {
                              document.getElementById('loader').style.display = 'none';
                          }, 500);
                      }, 1500);
                      
                      // 获取Canvas元素和上下文
                      const canvas = document.getElementById('canvas');
                      const ctx = canvas.getContext('2d');
                      
                      // 设置Canvas尺寸为窗口尺寸
                      function resizeCanvas() {
                          canvas.width = window.innerWidth;
                          canvas.height = window.innerHeight;
                      }
                      
                      // 初始化Canvas尺寸
                      resizeCanvas();
                      window.addEventListener('resize', resizeCanvas);
                      
                      // 爱心数组
                      let hearts = [];
                      // 文字数组
                      let texts = [];
                      
                      // 爱心类
                      class Heart {
                          constructor(x, y) {
                              this.x = x;
                              this.y = y;
                              this.size = Math.random() * 20 + 10;
                              this.speedX = Math.random() * 4 - 2;
                              this.speedY = Math.random() * 4 - 2;
                              this.color = `hsl(${Math.random() * 360}, 100%, 65%)`;
                              this.rotation = Math.random() * Math.PI * 2;
                              this.rotationSpeed = Math.random() * 0.1 - 0.05;
                              this.alpha = 1;
                              this.decay = Math.random() * 0.01 + 0.005;
                          }
                          
                          // 更新爱心位置和状态
                          update() {
                              this.x += this.speedX;
                              this.y += this.speedY;
                              this.rotation += this.rotationSpeed;
                              this.alpha -= this.decay;
                              
                              // 边界检测，让爱心在屏幕内反弹
                              if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                              if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
                              
                              // 如果爱心完全透明，标记为需要移除
                              return this.alpha > 0;
                          }
                          
                          // 绘制爱心
                          draw() {
                              ctx.save();
                              ctx.globalAlpha = this.alpha;
                              ctx.translate(this.x, this.y);
                              ctx.rotate(this.rotation);
                              ctx.fillStyle = this.color;
                              
                              // 绘制爱心形状
                              ctx.beginPath();
                              const topCurveHeight = this.size * 0.3;
                              ctx.moveTo(0, this.size / 4);
                              ctx.bezierCurveTo(
                                  -this.size / 2, -this.size / 2, 
                                  -this.size, topCurveHeight, 
                                  0, this.size
                              );
                              ctx.bezierCurveTo(
                                  this.size, topCurveHeight, 
                                  this.size / 2, -this.size / 2, 
                                  0, this.size / 4
                              );
                              ctx.fill();
                              
                              ctx.restore();
                          }
                      }
                      
                      // 文字类
                      class FloatingText {
                          constructor(text) {
                              this.text = text;
                              this.x = Math.random() * canvas.width;
                              this.y = canvas.height + 20;
                              this.size = Math.random() * 20 + 15;
                              this.speed = Math.random() * 2 + 1;
                              this.color = `hsl(${Math.random() * 360}, 100%, 70%)`;
                              this.alpha = 1;
                              this.rotation = Math.random() * 0.1 - 0.05;
                          }
                          
                          // 更新文字位置
                          update() {
                              this.y -= this.speed;
                              this.rotation += 0.005;
                              
                              // 如果文字移出屏幕顶部，标记为需要移除
                              return this.y > -20;
                          }
                          
                          // 绘制文字
                          draw() {
                              ctx.save();
                              ctx.globalAlpha = this.alpha;
                              ctx.fillStyle = this.color;
                              ctx.font = `bold ${this.size}px Arial`;
                              ctx.translate(this.x, this.y);
                              ctx.rotate(this.rotation);
                              ctx.textAlign = 'center';
                              ctx.fillText(this.text, 0, 0);
                              ctx.restore();
                          }
                      }
                      
                      // 添加爱心
                      function addHeart(x, y) {
                          hearts.push(new Heart(x, y));
                      }
                      
                      // 添加文字
                      function addText(text) {
                          if (text.trim() !== '') {
                              texts.push(new FloatingText(text));
                          }
                      }
                      
                      // 动画循环
                      function animate() {
                          // 清除画布
                          ctx.clearRect(0, 0, canvas.width, canvas.height);
                          
                          // 更新并绘制爱心
                          hearts = hearts.filter(heart => {
                              const keep = heart.update();
                              if (keep) heart.draw();
                              return keep;
                          });
                          
                          // 更新并绘制文字
                          texts = texts.filter(text => {
                              const keep = text.update();
                              if (keep) text.draw();
                              return keep;
                          });
                          
                          // 继续动画循环
                          requestAnimationFrame(animate);
                      }
                      
                      // 初始化一些爱心和文字
                      function init() {
                          // 添加一些初始爱心
                          for (let i = 0; i < 15; i++) {
                              addHeart(
                                  Math.random() * canvas.width,
                                  Math.random() * canvas.height
                              );
                          }
                          
                          // 添加一些初始文字
                          const initialTexts = ['爱', '幸福', '快乐', '美好', '梦想', '希望', '成功'];
                          initialTexts.forEach(text => addText(text));
                          
                          // 开始动画
                          animate();
                      }
                      
                      // 事件监听 - 同时支持触摸和点击
                      function handleInteraction(e) {
                          e.preventDefault();
                          let x, y;
                          
                          if (e.type.includes('touch')) {
                              x = e.touches[0].clientX;
                              y = e.touches[0].clientY;
                          } else {
                              x = e.clientX;
                              y = e.clientY;
                          }
                          
                          // 添加多个爱心增加效果
                          for (let i = 0; i < 3; i++) {
                              setTimeout(() => {
                                  addHeart(x + Math.random() * 40 - 20, y + Math.random() * 40 - 20);
                              }, i * 100);
                          }
                      }
                      
                      canvas.addEventListener('click', handleInteraction);
                      canvas.addEventListener('touchstart', handleInteraction);
                      
                      document.getElementById('addText').addEventListener('click', () => {
                          const textInput = document.getElementById('textInput');
                          addText(textInput.value);
                          textInput.value = '';
                          textInput.blur(); // 移动端收起键盘
                      });
                      
                      document.getElementById('addHearts').addEventListener('click', () => {
                          for (let i = 0; i < 10; i++) {
                              addHeart(
                                  Math.random() * canvas.width,
                                  Math.random() * canvas.height
                              );
                          }
                      });
                      
                      document.getElementById('clearAll').addEventListener('click', () => {
                          hearts = [];
                          texts = [];
                      });
                      
                      // 允许按Enter键添加文字
                      document.getElementById('textInput').addEventListener('keypress', (e) => {
                          if (e.key === 'Enter') {
                              document.getElementById('addText').click();
                          }
                      });
                      
                      // 初始化
                      init();
                      
                      // 防止移动端页面滚动
                      document.body.addEventListener('touchmove', function(e) {
                          if (e.target === canvas) {
                              e.preventDefault();
                          }
                      }, { passive: false });
                  });
              </script>
          </body>
          </html>
          EOF
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
